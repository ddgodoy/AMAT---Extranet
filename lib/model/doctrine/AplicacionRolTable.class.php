<?php
/**
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class AplicacionRolTable extends Doctrine_Table
{
   public static function getAplicacionRol($id)
   {
   	 $r = Doctrine_Query::create()
   	 ->from('Aplicacion')
   	 ->where('id = '.$id);
   	 $respuesat = $r->fetchOne();
   	 
   	 return $respuesat;
   }
   
   
   public static function getEmailPublicar($IDaplic = '', $gru = '', $cons= '', $org = '')
   {
   	 $r=Doctrine_Query::create()
   	    ->from('Usuario u');
   	 if($gru !='')
   	 {   
   	    $r->leftJoin('u.UsuarioGrupoTrabajo ugr');
   	 }  
   	 if($cons !='')
   	 { 
   	   $r->leftJoin('u.UsuarioConsejoTerritorial uct');
   	 }
   	 if($org !='')
   	 {   
   	   $r->leftJoin('u.UsuarioOrganismo uo');
   	 }  
   	   $r->leftJoin('u.UsuarioRol ur')
   	    ->leftJoin('ur.Rol r')
   	    ->leftJoin('r.AplicacionRol ar')
   	    ->where('ar.accion_publicar = 1');
   	    if($IDaplic!='')
   	    {
   	     	$r->andWhere('ar.aplicacion_id = '.$IDaplic);
   	    } 	
   	    if($gru !='')
	   	 {   
	   	    $r->andWhere('ugr.grupo_trabajo_id = '.$gru);
	   	 }  
	   	 if($cons !='')
	   	 { 
	   	   $r->andWhere('uct.consejo_territorial_id = '.$cons);
	   	 }
	   	 if($org !='')
	   	 {   
	   	   $r->andWhere('uo.organismo_id = '.$org);
	   	 }  
   	    $r->andWhere('u.deleted = 0 AND u.activo= 1');

   	  return $r->execute();   
   }

    public static function getEmailPublicarArray($IDaplic = '', $gru = '', $cons= '', $org = '')
   {
   	 $r=Doctrine_Query::create()
         ->select('u.id AS id, u.email AS email')
   	 ->from('Usuario u');
   	 if($gru !='')
   	 {
   	    $r->leftJoin('u.UsuarioGrupoTrabajo ugr');
   	 }
   	 if($cons !='')
   	 {
   	   $r->leftJoin('u.UsuarioConsejoTerritorial uct');
   	 }
   	 if($org !='')
   	 {
   	   $r->leftJoin('u.UsuarioOrganismo uo');
   	 }
   	   $r->leftJoin('u.UsuarioRol ur')
   	    ->leftJoin('ur.Rol r')
   	    ->leftJoin('r.AplicacionRol ar')
   	    ->where('ar.accion_publicar = 1');
   	    if($IDaplic!='')
   	    {
   	     	$r->andWhere('ar.aplicacion_id = '.$IDaplic);
   	    }
   	    if($gru !='')
	   	 {
	   	    $r->andWhere('ugr.grupo_trabajo_id = '.$gru);
	   	 }
	   	 if($cons !='')
	   	 {
	   	   $r->andWhere('uct.consejo_territorial_id = '.$cons);
	   	 }
	   	 if($org !='')
	   	 {
	   	   $r->andWhere('uo.organismo_id = '.$org);
	   	 }
   	    $r->andWhere('u.deleted = 0 AND u.activo= 1');

   	  return $r->execute();
   }


   public static function getEmailEventoPublicar($IDaplic)
   {
   	 $r=Doctrine_Query::create()
          ->select('u.id, u.email')
   	      ->from('Usuario u')
   	      ->leftJoin('u.UsuarioRol ur')
   	      ->leftJoin('ur.Rol r')
   	      ->leftJoin('r.AplicacionRol ar')
   	      ->where('ar.accion_publicar = 1')
   	      ->andWhere('ar.aplicacion_id = '.$IDaplic)
   	      ->andWhere('u.activo=1
                     AND r.deleted=0
                     AND u.deleted = 0
                     AND ur.deleted = 0
                     AND ar.deleted = 0
                    ');

   	  return $r->fetchArray(); 
   }


   
   public static function getAplicacionByRol($idrol)
   {
   	 $r=Doctrine_Query::create()
   	    ->from('AplicacionRol ar')
   	    ->leftJoin('ar.Aplicacion a')
   	    ->andWhere('ar.rol_id = '.$idrol)
   	    ->andWhere('a.deleted = 0 AND ar.deleted = 0')
   	    ->andWhere('a.id != 44 AND a.id != 46')
   	    ->orderBy('a.nombre');
   	   
   	  return $r->execute();   
   }
   
   
   
}